-- =====================================================
-- RLS ポリシー修正: ks_users の自己参照問題を解決
-- =====================================================
-- 問題: 既存の ks_users_select ポリシーは自己参照サブクエリを使い、
--       新規ユーザーが自分のレコードを読めない状態だった。
-- 解決: 自分の auth_uid に一致するレコードを直接読めるポリシーを追加。
--       （Postgres の RLS は複数ポリシーが OR で評価される）

-- ユーザーは自分自身の ks_users レコードを常に読める
CREATE POLICY "ks_users_select_own" ON ks_users
  FOR SELECT USING (auth_uid = auth.uid());
